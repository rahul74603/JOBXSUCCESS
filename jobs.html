<!-- ‚úÖ Config.js ‡§™‡§π‡§≤‡•á ‡§≤‡•ã‡§° ‡§π‡•ã -->
<script src="config.js" defer></script>

<script>
    document.addEventListener("DOMContentLoaded", async function () {
        console.log("üöÄ Config.js ‡§≤‡•ã‡§° ‡§π‡•Å‡§Ü:", window.API_URL); // ‚úÖ Debugging

        // ‚úÖ API Key ‡§ï‡•ã LocalStorage ‡§∏‡•á ‡§≤‡•á‡§Ç
        let apiKey = localStorage.getItem("apiKey");

        if (!apiKey) {
            console.error("‚ùå API Key Not Found!");
            alert("‚ö†Ô∏è API Key ‡§∏‡•á‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à! ‡§™‡§π‡§≤‡•á API Key ‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç‡•§");
            return;
        }

        // ‚úÖ ‡§∏‡§π‡•Ä API_URL ‡§¨‡§®‡§æ‡§è‡§Ç (Google Apps Script + Secret Key)
        let API_URL = `${window.API_URL}?key=${apiKey}`;
        console.log("‚úÖ Final API_URL:", API_URL);

        async function fetchJobs() {
            try {
                const response = await fetch(API_URL);
                const jobs = await response.json();

                const tableBody = document.querySelector("#jobs-table tbody");
                tableBody.innerHTML = "";

                jobs.forEach(job => {
                    const row = document.createElement("tr");

                    const titleCell = document.createElement("td");
                    titleCell.textContent = job.title;
                    row.appendChild(titleCell);

                    const orgCell = document.createElement("td");
                    orgCell.textContent = job.organization;
                    row.appendChild(orgCell);

                    const dateCell = document.createElement("td");
                    dateCell.textContent = job.lastDate;
                    row.appendChild(dateCell);

                    const linkCell = document.createElement("td");
                    const link = document.createElement("a");
                    link.href = job.applyLink;
                    link.textContent = "Apply";
                    link.target = "_blank";
                    linkCell.appendChild(link);
                    row.appendChild(linkCell);

                    tableBody.appendChild(row);
                });

                document.getElementById("loading").style.display = "none";
            } catch (error) {
                document.getElementById("loading").textContent = "‚ùå ‡§ú‡•â‡§¨ ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ!";
                console.error("‚ùå Error fetching jobs:", error);
            }
        }

        fetchJobs();
    });
</script>
