<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ЁЯФе рдиреМрдХрд░реА рдЕрдкрдбреЗрдЯреНрд╕ - JOBXSUCCESS</title>
    <link rel="stylesheet" href="style.css">
    
    <!-- тЬЕ Config.js рдкрд╣рд▓реЗ рд▓реЛрдб рдХрд░реЗрдВ -->
    <script src="config.js" defer></script>
</head>
<body>

    <h1>ЁЯФе рдиреМрдХрд░реА рдЕрдкрдбреЗрдЯреНрд╕</h1>

    <!-- тЬЕ Loading Message -->
    <p id="loading">тП│ рдЬреЙрдм рдбреЗрдЯрд╛ рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...</p>

    <!-- тЬЕ Jobs Table -->
    <table id="jobs-table" border="1">
        <thead>
            <tr>
                <th>ЁЯФ╣ рдиреМрдХрд░реА рдХрд╛ рдирд╛рдо</th>
                <th>ЁЯПв рдХрдВрдкрдиреА</th>
                <th>ЁЯУЕ рдЕрдВрддрд┐рдо рддрд┐рдерд┐</th>
                <th>тЮбя╕П рдЖрд╡реЗрджрди</th>
            </tr>
        </thead>
        <tbody>
            <!-- тЬЕ рдЬреЙрдм рдбреЗрдЯрд╛ рдпрд╣рд╛рдВ рд▓реЛрдб рд╣реЛрдЧрд╛ -->
        </tbody>
    </table>

    <!-- тЬЕ JavaScript Script рд▓реЛрдб рдХрд░реЗрдВ -->
    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            console.log("ЁЯЪА Config.js рд▓реЛрдб рд╣реБрдЖ:", window.API_URL); // тЬЕ Debugging

            // тЬЕ API Key рдХреЛ LocalStorage рд╕реЗ рд▓реЗрдВ
            let apiKey = localStorage.getItem("apiKey");

            if (!apiKey) {
                console.error("тЭМ API Key Not Found!");
                alert("тЪая╕П API Key рд╕реЗрдЯ рдирд╣реАрдВ рд╣реИ! рдкрд╣рд▓реЗ API Key рд╕реЗрдЯ рдХрд░реЗрдВред");
                return;
            }

            // тЬЕ рд╕рд╣реА API_URL рдмрдирд╛рдПрдВ (Google Apps Script + Secret Key)
            let API_URL = `${window.API_URL}?key=${apiKey}`;
            console.log("тЬЕ Final API_URL:", API_URL);

            // тЬЕ Check if Table Exists
            const tableBody = document.querySelector("#jobs-table tbody");
            const loadingElement = document.getElementById("loading");

            if (!tableBody || !loadingElement) {
                console.error("тЭМ Error: 'jobs-table' рдпрд╛ 'loading' рдПрд▓рд┐рдореЗрдВрдЯ рдирд╣реАрдВ рдорд┐рд▓рд╛!");
                return;
            }

            async function fetchJobs() {
                try {
                    loadingElement.style.display = "block"; // тЬЕ Show Loading
                    tableBody.innerHTML = ""; // тЬЕ Clear Old Data

                    // тЬЕ Fetch Jobs from API
                    console.log("ЁЯМН Fetching Jobs from API...");
                    let response = await fetch(`${API_URL}&t=${new Date().getTime()}`);
                    
                    if (!response.ok) throw new Error(`HTTP error! Status: ${response.status}`);

                    let jobs = await response.json();

                    if (!Array.isArray(jobs)) throw new Error("Invalid Data Format from API");

                    // тЬЕ Insert Data into Table
                    jobs.forEach(job => {
                        let row = document.createElement("tr");

                        row.innerHTML = `
                            <td>${job.title}</td>
                            <td>${job.organization || "N/A"}</td>
                            <td>${job.lastDate || "N/A"}</td>
                            <td><a href="${job.applyLink}" target="_blank">Apply</a></td>
                        `;

                        tableBody.appendChild(row);
                    });

                    loadingElement.style.display = "none"; // тЬЕ Hide Loading
                } catch (error) {
                    console.error("тЭМ Error fetching jobs:", error);
                    loadingElement.textContent = "тЭМ рдЬреЙрдм рдбреЗрдЯрд╛ рд▓реЛрдб рдХрд░рдиреЗ рдореЗрдВ рд╕рдорд╕реНрдпрд╛!";
                }
            }

            fetchJobs();
        });
    </script>

</body>
</html>
