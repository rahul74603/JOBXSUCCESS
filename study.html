<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìö Study Materials - JOBXSUCCESS</title>
    <link rel="stylesheet" href="style.css"> <!-- ‚úÖ External CSS -->
</head>
<body>

    <!-- üîπ Navigation Bar -->
    <div class="navbar">
        <a href="index.html">üè† Home</a>
        <a href="jobs.html">üìå Government Jobs</a>
        <a href="study.html" class="active">üìö Study Materials</a>
    </div>

    <h1>üìö ‡§´‡•ç‡§∞‡•Ä ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§Æ‡§ü‡•á‡§∞‡§ø‡§Ø‡§≤‡•ç‡§∏</h1>

    <div id="materials-container">
        <h2>üìÇ Firebase ‡§∏‡•á ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§Æ‡§ü‡•á‡§∞‡§ø‡§Ø‡§≤</h2>
        <ul id="firebase-materials"></ul>

        <h2>üìÇ GitHub ‡§∏‡•á ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§Æ‡§ü‡•á‡§∞‡§ø‡§Ø‡§≤</h2>
        <ul id="github-materials"></ul>
    </div>

    <!-- üî• Firebase SDK + Config -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

        // ‚úÖ Firebase Config ‡§ï‡•ã fetch() ‡§∏‡•á ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
        async function loadFirebaseConfig() {
            try {
                const response = await fetch("./firebase-config.json"); // ‚úÖ JSON Config ‡§´‡§æ‡§á‡§≤
                const firebaseConfig = await response.json();
                return firebaseConfig;
            } catch (error) {
                console.error("‚ùå Firebase Config ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ï‡•ç‡§ï‡§§:", error);
                return null;
            }
        }

        // ‚úÖ Firebase ‡§∏‡•á Study Materials ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ
        async function fetchMaterials() {
            const firebaseConfig = await loadFirebaseConfig();
            if (!firebaseConfig) return; // ‡§Ö‡§ó‡§∞ Config ‡§≤‡•ã‡§° ‡§®‡§π‡•Ä‡§Ç ‡§π‡•Å‡§Ü, ‡§§‡•ã ‡§Ü‡§ó‡•á ‡§Æ‡§§ ‡§¨‡§¢‡§º‡•ã‡•§

            const app = initializeApp(firebaseConfig);
            const db = getDatabase(app);

            const materialsList = document.getElementById("firebase-materials");
            const materialsRef = ref(db, "StudyMaterials");

            onValue(materialsRef, (snapshot) => {
                materialsList.innerHTML = "";
                const data = snapshot.val();

                if (data) {
                    Object.keys(data).forEach((key) => {
                        const material = data[key];
                        const li = document.createElement("li");

                        const title = material.title || "N/A";
                        const downloadLink = material.link || "#";

                        li.innerHTML = `
                            <h3>üîπ ${title}</h3>
                            <a href="${downloadLink}" target="_blank" class="download-btn">üì• Download Now</a>
                        `;
                        materialsList.appendChild(li);
                    });
                } else {
                    materialsList.innerHTML = "<p>‚ö†Ô∏è ‡§ï‡•ã‡§à ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§Æ‡§ü‡•á‡§∞‡§ø‡§Ø‡§≤ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>";
                }
            });
        }

        fetchMaterials();

        // ‚úÖ GitHub ‡§∏‡•á Study Materials ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡§æ
        async function fetchGitHubMaterials() {
            const githubRepo = "https://api.github.com/repos/JOBXSUCCESS/study-materials/contents";
            const githubList = document.getElementById("github-materials");

            try {
                const response = await fetch(githubRepo);
                if (!response.ok) throw new Error(`GitHub API Error: ${response.status}`);

                const folders = await response.json();
                githubList.innerHTML = "";

                if (Array.isArray(folders)) {
                    folders.forEach(folder => {
                        if (folder.type === "dir") {
                            const li = document.createElement("li");
                            li.innerHTML = `
                                <a href="#" onclick="loadCategory('${folder.name}')">${folder.name}</a>
                            `;
                            githubList.appendChild(li);
                        }
                    });
                } else {
                    githubList.innerHTML = "<p>‚ö†Ô∏è ‡§ï‡•ã‡§à ‡§∏‡•ç‡§ü‡§°‡•Ä ‡§Æ‡§ü‡•á‡§∞‡§ø‡§Ø‡§≤ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§</p>";
                }
            } catch (error) {
                console.error("‚ùå GitHub ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ï‡•ç‡§ï‡§§:", error);
            }
        }

        fetchGitHubMaterials();

        // ‚úÖ ‡§ú‡§¨ ‡§ï‡•ã‡§à ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§ñ‡•Å‡§≤‡•á, ‡§§‡•ã ‡§Ö‡§Ç‡§¶‡§∞ ‡§ï‡•á ‡§´‡•ã‡§≤‡•ç‡§°‡§∞ ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
        window.loadCategory = async function (category) {
            const categoryRepo = `https://api.github.com/repos/JOBXSUCCESS/study-materials/contents/${category}`;
            const githubList = document.getElementById("github-materials");

            try {
                const response = await fetch(categoryRepo);
                if (!response.ok) throw new Error(`GitHub API Error: ${response.status}`);

                const subFolders = await response.json();
                githubList.innerHTML = `<h3>${category}</h3>`;

                if (Array.isArray(subFolders)) {
                    subFolders.forEach(subFolder => {
                        if (subFolder.type === "dir") {
                            const li = document.createElement("li");
                            li.innerHTML = `
                                <a href="#" onclick="loadFiles('${category}', '${subFolder.name}')">${subFolder.name}</a>
                            `;
                            githubList.appendChild(li);
                        }
                    });
                } else {
                    githubList.innerHTML += "<p>‚ö†Ô∏è ‡§á‡§∏ ‡§ï‡•à‡§ü‡•á‡§ó‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</p>";
                }
            } catch (error) {
                console.error("‚ùå GitHub ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ï‡•ç‡§ï‡§§:", error);
            }
        };

        // ‚úÖ ‡§ú‡§¨ ‡§ï‡•ã‡§à ‡§´‡•ã‡§≤‡•ç‡§°‡§∞ ‡§ñ‡•Å‡§≤‡•á, ‡§§‡•ã ‡§´‡§æ‡§á‡§≤‡•á‡§Ç ‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
        window.loadFiles = async function (category, subCategory) {
            const filesRepo = `https://api.github.com/repos/JOBXSUCCESS/study-materials/contents/${category}/${subCategory}`;
            const githubList = document.getElementById("github-materials");

            try {
                const response = await fetch(filesRepo);
                if (!response.ok) throw new Error(`GitHub API Error: ${response.status}`);

                const files = await response.json();
                githubList.innerHTML = `<h3>${subCategory} (üìÇ ${category})</h3>`;

                if (Array.isArray(files)) {
                    files.forEach(file => {
                        if (file.type === "file") {
                            const li = document.createElement("li");
                            li.innerHTML = `
                                <a href="${file.download_url}" target="_blank">üìÑ ${file.name}</a>
                            `;
                            githubList.appendChild(li);
                        }
                    });
                } else {
                    githubList.innerHTML += "<p>‚ö†Ô∏è ‡§á‡§∏ ‡§´‡•ã‡§≤‡•ç‡§°‡§∞ ‡§Æ‡•á‡§Ç ‡§ï‡•Å‡§õ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§</p>";
                }
            } catch (error) {
                console.error("‚ùå GitHub ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§¶‡§ø‡§ï‡•ç‡§ï‡§§:", error);
            }
        };
    </script>

</body>
</html>
